//CoastGuard-RecoverPilot - KSC Coast Guard: Recover downed test pilot (pilotName)!

CONTRACT_TYPE
{


//REQUIREMENTS FOR CONTRACT TO APPEAR

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract

		contractType = CoastGuard-Certification
		minCount = 1
		
	}
	
		REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract

		contractType = Wright-FirstFlight
		minCount = 1
		
	}
	
	
//DATA NODES TO PROCESS FOR CONTRACT USE

	//List of Coast Guard Team Members
	DATA
	{
		type = List<Kerbal>
		
		kerbalsCoastGuard = [ NewKerbal( Male , "Lt. Dan Kerman" , "Pilot") ]
		
	}
	
	//List of Kerbals in Distress
	DATA
	{
		type = List<Kerbal>
		
		kerbalsInDistress = [ NewKerbalWithTrait( "Pilot" ) ]
	
	}
	
	//Random Distress Location Pulled from Waypoint Generator Behaviour
	DATA
	{
		type = double
		
		distressLat = @/DistressLocation.Waypoints().ElementAt(1).Latitude()
		distressLon = @/DistressLocation.Waypoints().ElementAt(1).Longitude()

	}
	

//CONTRACT DESCRIPTION

	name = CoastGuard-RecoverPilot
	title = Recover downed test pilot @/kerbalsInDistress.First()!
	group = KSC Coast Guard
	agent = KSC Coast Guard

	description = The KSC Coast Guard has received a call from the Kerbal Space Program to pickup @/kerbalsInDistress.First() who had to eject his craft during a test flight somewhere within our search and rescue area. Send out a rescue team and retrieve the test pilot. Your craft will need to land at either the Vehicle Assembly Building helipads, or land, taxi, and park next to the Spaceplane Hangar Air Terminal in order to recover the pilot safely and bring him back for a medical checkup and debriefing.

	synopsis = KSC Coast Guard: Our motto is Always Ready - Kemper Keratus!

	notes = Rescue and retrieve @/kerbalsInDistress.First() from somewhere within the search and rescue area. Bring them back to KSC safely.

	completedMessage = KSC Coast Guard rescue mission accomplished! @/kerbalsInDistress.First() was retrieved from the area with minimal injury. Your successful operation hasn't gone unnoticed by the Kerbal Space Program. Check in with Mission Control for your next mission.

//Contract Limits
	maxCompletions = 1
	maxSimultaneous = 1
	weight = 10.0

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 1.0
	maxExpiry = 1.0
	deadline = 1

//Contract Reward Modifiers
	prestige = Trivial
	targetBody = Kerbin

//Contract Rewards
	advanceFunds = 2000.0
	rewardFunds = 0.0
	rewardReputation = 10.0
	rewardScience = 0.0

//Contract Penalties
	failureFunds = 0.0
 	failureReputation = 10.0


//BEHAVIOURS TO DO WHEN CREATING CONTRACT

	BEHAVIOUR
	{
		name = SpawnKerbal
		type = SpawnKerbal

		KERBAL
		{
		
			kerbal = @/kerbalsInDistress.First()
			kerbalType = Unowned
			owned = false
			addToRoster = false
			
			lat = @/distressLat
			long = @/distressLon
			heading = 300

		}
		
	}
 
	BEHAVIOUR
	{
		name = DistressLocation
		type = WaypointGenerator

		PQS_CITY
		{
			name = Search and Rescue Area 
			icon = marker
			
			targetBody = Kerbin
			pqsCity = KSC
			pqsOffset = 3636.74176576774, 948.452291817594, -54.6489646538366
		
		}
		
		//Randomize Within a 100km Radius Waypoint from Search and Rescue Area
		RANDOM_WAYPOINT_NEAR
		{
		
			name = Downed Test Pilot Coordinates
			icon = marker
			
			targetBody = Kerbin
			nearIndex = 0
			maxDistance = 100000.0
			altitude = 0.0
		
		}
		
	}


//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your craft must
		
		define = craft
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a Kerbal in command
			
			minCrew = 1
		
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrewCapacity
			type = HasCrewCapacity
			title = have at least 2 passenger seats
			
			minCapacity = 3
			
			disableOnStateChange = false
			
		}
		
		disableOnStateChange = false

	}
	
//Passenger Manifest - Load Passengers
	PARAMETER
	{
		name = All
		type = All
		
		title = load your Coast Guard rescue officer
		
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsCoastGuard
				
			}
			
			hideChildren = true
			
		}

	}

//Contract Goals
	PARAMETER
	{
		name = VisitWaypoint
		type = VisitWaypoint
		title = Downed Test Pilot Coordinates
		
		index = 0
		distance = 500
		hideOnCompletion = true
		
		disableOnStateChange = true
		hideChildren = true
		
	}

	PARAMETER
	{
		name = HasPassengers
		type = HasPassengers
		title = rescue crewman
		
		completeInSequence = true
		disableOnStateChange = false
		
	}

//Recovery Parameter - Landing
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = and land back on land
		
		vessel = craft
	
	PARAMETER
		{
			name = ReachState
			type = ReachState
			
			targetBody = Kerbin
			situation = LANDED
			maxSpeed = 0.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			hidden = true

		}
	
		completeInSequence = true
		hideChildren = true

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely
		
		completeInSequence = true
		disableOnStateChange = true
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your craft
			
			vessel = craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			countMax = 1

		}
		
	}
	
//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
		name = All
		type = All
		title = and recover
		
		PARAMETER
		{
			name = RecoverKerbal
			type = RecoverKerbal
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbals
				
			}
			
			hideChildren = true
			
		}
		
	}
	
}