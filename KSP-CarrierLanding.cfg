//KSP-CarrierLanding - Kerbal Space Program: Aircraft Carrier Landing

CONTRACT_TYPE
{


//REQUIREMENTS FOR CONTRACT TO APPEAR

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = SSI-Seaplane
		minCount = 1

	}
	
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = CoastGuard-DropBuoys
		minCount = 1
		
	}
	
	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract
		
		contractType = CoastGuard-RescuePilot
		minCount = 1
		
	}
	
	
//DATA NODES TO PROCESS FOR CONTRACT USE
	
	//Location Pulled from Waypoint Generator Behaviour
	DATA
	{
		type = double
		
		carrierLat = @/WaypointGenerator.Waypoints().ElementAt(0).Latitude()
		carrierLon = @/WaypointGenerator.Waypoints().ElementAt(0).Longitude()

	}


//CONTRACT DESCRIPTION

	name = KSP-CarrierLanding
	title = Aircraft Carrier Landing
	group = Kerbal Space Program
	agent = Kerbal Space Program

	description = You've landed on water. Landing on water is not very convenient for a quick turn around. Eugene Kerman of the Kerbal Space Program believes it's possible to land an airplane on a boat though if given the right setup. Many say it is impossible. but one brave test pilot, Eugene Kerman thinks it can easily be done if you use max brake torque or a reverse thruster technique. To test the theory, the Kerbal Space Program has retrofitted the KSS Rix with a flat top for the attempt.\n\nUnfortuantely, Eugene Kerman was injured in an unrelated recent test flight, and the Kerbal Space Program is asking your organization to make the attempt.

	synopsis = Perform the first aircraft carrier landing.

	notes = You've practiced lots of times landing paper airplanes on a postage stamp. Now you get to do the real thing and prove it can be done!

	completedMessage = Congratulations on performing the first ever aircraft carrier landing! Eugene Kerman says such a feat will make it possible now to extend the range of the KSC Coast Guard's rescue and retrieval operational theater to cover the entire world, and enable retrieval of future space crews for the Kerbal Space Program, from anywhere around the world.

//Contract Limits
   	maxCompletions = 1
   	maxSimultaneous = 1
	weight = 10.0

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 7.0
	maxExpiry = 7.0
	deadline = 0

//Contract Reward Modifiers
	prestige = Trivial
   	targetBody = Kerbin

//Contract Rewards
  	advanceFunds = 10000.0
  	rewardFunds = 100000.0
  	rewardReputation = 50.0
 	rewardScience = 5.0

//Contract Penalties
  	failureFunds = 25000.0
	failureReputation = 5.0


//BEHAVIOURS TO DO WHEN CREATING CONTRACT

//Spawn Aircraft Carrier
	BEHAVIOUR
	{
		name = SpawnVessel
		type = SpawnVessel
		deferVesselCreation = false

		VESSEL
		{
			name = KSS Rix
			craftURL = ContractPacks/GAP/Assets/Sea/Inigma Class Carrier.craft
			vesselType = Ship
			owned = false
			targetBody = Kerbin
			
			lat = @/carrierLat
			lon = @/carrierLon
			alt = -1
			heading = 90
			
		}
		
	}
	
//Remove all SpawnVessels when done
	BEHAVIOUR
	{
		name = DestroyVessel
		type = DestroyVessel
		
		vessel = KSS Rix

		onState = CONTRACT_COMPLETED
		
	}


//Generate Waypoints for Carrier and Island Airfield
	BEHAVIOUR
	{
		name = WaypointGenerator
		type = WaypointGenerator

		//Aircraft Carrier Waypoint
		PQS_CITY
		{
			name = KSS Rix Landing Area
			icon = marker
			
			targetBody = Kerbin
			pqsCity = KSC
			pqsOffset = 3636.74176576774, 948.452291817594, -54.6489646538366
			altitude = 6
		
		}
		
		//Island Airfield Waypoint
		PQS_CITY
		{
			name = KSC Island Airfield
			icon = marker
			
			targetBody = Kerbin
			pqsCity = IslandAirfield
			pqsOffset = -44.0509605753032, -247.057216484056, 18.0797328829649
			altitude = 24
			hidden = true
		
		}
		
	}
	
	
//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your aircraft must
		
		define = craft
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a certified pilot
			
			trait = Pilot
			minCrew = 1
		
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = PartValidation
			type = PartValidation
			title = have wings
			
			category = Aero
			
			disableOnStateChange = false
			hideChildren = true

		}
		
		disableOnStateChange = false

	}

//Aircraft Carrier Landing
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = land on the KSS Rix
		
		vessel = craft
	
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 55
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}
		
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = LANDED
			maxSpeed = 5.0
			minAltitude = 3
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	

	}
	
//Aircraft Carrier Takeoff
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = take off from the KSS Rix
		
		vessel = craft
	
		PARAMETER
		{			            
			name = ReachState   
			type = ReachState

			situation = FLYING
			minSpeed = 5.0
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}
		
		PARAMETER
		{
			name = VisitWaypoint
			type = VisitWaypoint
			index = 0

			distance = 80
			hideOnCompletion = false
			
			completeInSequence = true
			disableOnStateChange = false
			hideChildren = true
			
		}

		completeInSequence = true
		disableOnStateChange = true
		hideChildren = true	

	}
	
//Recovery Parameter - Landing
	PARAMETER
	{
		name = Any
		type = Any
		title = and then land
		
		PARAMETER
		{
			name = Any
			type = Any
			title = at either
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Island Airfield
				
				vessel = craft
				
				REQUIREMENT
				{
					name = CompleteContract
					type = CompleteContract

					contractType = KSP-IslandPrep
					minCount = 1
					
				}

				PARAMETER
				{
					name = LandatIslandAirfield
					type = All

					PARAMETER
					{
						name = VisitWaypoint
						type = VisitWaypoint
						index = 1

						distance = 800
						hideOnCompletion = true
						
						disableOnStateChange = false
						hideChildren = true
						
					}
					
					PARAMETER
					{			            
						name = ReachState   
						type = ReachState

						situation = LANDED
						maxSpeed = 0.0
						
						disableOnStateChange = false
						hideChildren = true
						
					}
					
					disableOnStateChange = false
					hideChildren = true
					hidden = true
				
				}

				disableOnStateChange = false
				hideChildren = true

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Runway
				
				vessel = craft

				PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = Runway
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}
				
				disableOnStateChange = false
				hideChildren = true

			}
			
			completeInSequence = true
			disableOnStateChange = false
		
		}
		
		completeInSequence = true
		disableOnStateChange = false

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your aircraft
			
			vessel = craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			countMax = 1

		}

		completeInSequence = true
		disableOnStateChange = true

	}
	
}
