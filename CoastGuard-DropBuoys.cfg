//CoastGuard-DropBuoys - KSC Coast Guard: Drop 2 navigation buoys by aircraft.

CONTRACT_TYPE
{


//REQUIREMENTS FOR CONTRACT TO APPEAR

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract

		contractType = CoastGuard-Certification
		minCount = 1
		
	}

	
//DATA NODES TO PROCESS FOR CONTRACT USE

	//List of Coast Guard Team Members
	DATA
	{
		type = List<Kerbal>
		
		kerbalsCoastGuard = [ NewKerbal( Female , "Ens. Ro Kerman" , "Scientist") ]
		
	}
	
	//Random Buoy Drop Zone Location Pulled from Waypoint Generator Behaviour
	DATA
	{
		type = double
		
		zoneLat = @/BuoyDropZones.Waypoints().ElementAt(5).Latitude()
		zoneLong = @/BuoyDropZones.Waypoints().ElementAt(5).Longitude()

	}
	
	
//CONTRACT DESCRIPTION

	name = CoastGuard-DropBuoys
	title = Drop 2 navigation buoys by aircraft.
	group = KSC Coast Guard
	agent = KSC Coast Guard

	description = The waters off of KSC can sometimes be treacherous in rough weather. The KSC Coast Guard needs a few navigation buoys dropped at (location) to help surface vessels find their way home in a storm. The buoys will contain a barometer to also provide data to KSC scientists of any impending storms.\n\nLt. Dan Kerman wants you to take Ens. Ro Kerman on a buoy drop over (location). Once you accept this mission, the KSC Coast Guard will forward you the plans for building a buoy in your SPH, and will forward you funds to build two of them. You are welcome to use the provided plans, or else build your own buoys, but the buoys dropped for this mission must contain a barometer.

	synopsis = KSC Coast Guard: Our motto is Always Ready - Kemper Keratus!

	notes = You may use an airplane, helicopter, or VTOL.
	
	completedMessage = Mission Completed!

//Contract Limits
	maxCompletions = 0
	maxSimultaneous = 1
	weight = 10.0

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 1.0
	maxExpiry = 1.0
	deadline = 1

//Contract Reward Modifiers
	prestige = Trivial
	targetBody = Kerbin
	
//Contract Rewards
  	advanceFunds = 8000.0
	rewardFunds = 5000.0
  	rewardReputation = 2.0
 	rewardScience = 5.0
	
//Contract Penalties
  	failureFunds = 10000.0
	failureReputation = 20.0
	

//BEHAVIOURS TO DO WHEN CREATING CONTRACT
	BEHAVIOUR
	{
		name = SpawnPassengers
		type = SpawnPassengers
		
		kerbal = @/kerbalsCoastGuard.ElementAt(0)
		kerbalType = Crew
		
	}
	
	BEHAVIOUR
	{
		name = BuoyDropZones
		type = WaypointGenerator
		
		//Rescue Areas
		
		PQS_CITY
		{
			name = KSC Sea North
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = -1847.25488069029, -20058.7598335702, -453.396403818988
			
			hidden = true
			
		}		

		PQS_CITY
		{
			name = KSC Sea Central
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 20550.8508273184, 1062.93579726917, -468.244493385362
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = KSC Sea South
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 29140.5802921804, 15569.5873430977, -1025.49583004066
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = East Islands Sea
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = -13479.0987451144, 22129.2856859656, -674.933362233103
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = South Islands Sea
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 4175.6529485127, 49157.8040008561, -2146.85443912575
			
			hidden = true
			
		}
		
		//Randomize a 5000m Radius Waypoint Near Drop Zone Area
		
	    RANDOM_WAYPOINT_NEAR
		{
		
			name = Buoy Drop Zone
			icon = marker
			
			targetBody = Kerbin
			nearIndex = Random(0,4)
			maxDistance = 7500.0
			altitude = 0.0
		
		}
		
	}
	
	
//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your craft must
		
		define = craft
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a Kerbal in command
			
			minCrew = 1
		
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrewCapacity
			type = HasCrewCapacity
			title = have at least 1 passenger seat
			
			minCapacity = 2
			
			disableOnStateChange = false
			
		}
		
		disableOnStateChange = false

	}

//Passenger Manifest - Load Passengers
	PARAMETER
	{
		name = All
		type = All
		
		title = load your Coast Guard buoy drop officer
		
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsCoastGuard
				
			}
			
			hideChildren = true
			
		}

	}
	
	PARAMETER
	{
		name = PartValidation
		type = PartValidation
		title = have 2 buoys on board

		part = sensorBarometer

		disableOnStateChange = true
		hideChildren = true
		
	}

//Contract Goals
	PARAMETER
	{
		name = VisitWaypoint
		type = VisitWaypoint
		title = navigate to Buoy Drop Zone
		
		index = 5
		distance = 5000
		hideOnCompletion = true
		
		disableOnStateChange = true
		hideChildren = true
		
	}
	
	PARAMETER
	{
		name = PartValidation
		type = PartValidation
		title = drop 2 buoys
		
		NONE
		{
			part = sensorBarometer
			
		}

		completeInSequence = true
		hideChildren = true
		
	}

//Recovery Parameter - Landing
	PARAMETER
	{
		name = Any
		type = Any
		title = and then land back
		
		PARAMETER
		{
			name = Any
			type = Any
			title = on either
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Island Airfield
				
				vessel = craft
				
				REQUIREMENT
				{
					name = CompleteContract
					type = CompleteContract

					contractType = KSP-IslandPrep
					minCount = 1
					
				}

				PARAMETER
				{
					name = ReachState
					type = ReachState

					targetBody = Kerbin
					biome = IslandAirfield	
					situation = LANDED
					maxSpeed = 0.0
					
					disableOnStateChange = false
					hideChildren = true
					
				}

				hideChildren = true

			}

			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC Runway
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = Runway
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the Spaceplane Hangar Air Terminal
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = SPH
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the Vehicle Assembly Building Helipad
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = VAB Main Building
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = or the Administration Building Helipad
				
				vessel = craft

				PARAMETER
				{
					name = ReachState
					type = ReachState

					targetBody = Kerbin
					biome = Administration	
					situation = LANDED
					maxSpeed = 0.0
					
					disableOnStateChange = false
					hideChildren = true
					
				}

				hideChildren = true	

			}
		
		}

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your craft
			
			vessel = craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			countMax = 1

		}
	
		completeInSequence = true
		disableOnStateChange = true	

	}
	
//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
		name = All
		type = All
		title = and recover
		
		PARAMETER
		{
			name = RecoverKerbal
			type = RecoverKerbal
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsCoastGuard
				
			}
			
			hideChildren = true
			
		}
		
	}
	
}