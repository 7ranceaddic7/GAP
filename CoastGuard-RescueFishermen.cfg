//CoastGuard-RescueFishermen - KSC Coast Guard: S.O.S. Distress Call - (shipName)

CONTRACT_TYPE
{


//REQUIREMENTS FOR CONTRACT TO APPEAR

	REQUIREMENT
	{
		name = CompleteContract
		type = CompleteContract

		contractType = CoastGuard-Certification
		minCount = 1
		
	}

	
//DATA NODES TO PROCESS FOR CONTRACT USE

	//List of Coast Guard Team Members
	DATA
	{
		type = List<Kerbal>
		
		kerbalsCoastGuard = [ NewKerbal( Male , "Lt. Dan Kerman" , "Pilot") ]
		
	}

	//List of Kerbals in Distress
	DATA
	{
		type = List<Kerbal>
		
		kerbalsInDistress = [ NewKerbal(), NewKerbal() ]
	
	}	

	//Random Ship Name (Based on Kerbal name generator, cool idea huh?)
	DATA
	{
	type = string
	
		shipName = "S.S. " + RandomKerbalName(Random()).FirstWord()
	
	}
	
	//List of Possible Distress Reports
	DATA
	{
		type = List<string>
		
		distressReportData = [ "their engine has taken on water" , "they had an engine fire" , "their rudder is disabled", "their ship was hit by a rogue wave in the recent storm", "there was a fight over the last remaining snacks and in the scuffle the keys to the engine were lost overboard", "caught such a large fish that that their boat flipped over twice (the dispatcher doesn't quite believe this fish story)", "that they were attacked by what they thought was a sea kracken (but dispatch believes they forgot to top off their fuel tanks before leaving port)", "that they thought they spotted Scott Manley off the port bow, but it turned out to be nothing more than a piece of floating debris from KSC, which they attempted to haul on board, and in the process of doing so, they sliced through their engine control cables" ]

	}
	
	//Pick One Random Distress Report to Use for Contract
	DATA
	{
		type = string
		
		distressReport = @/distressReportData.Random()
		
	}
	
	//SpawnVessel Roll List Values for Capsize Determination
	DATA
	{
		type = List<int>
		
		capsizeValueList = [ 0 , 180 ]
		
	}
	
	//Random Capsize Decision
	DATA
	{
		type = int
		
		capsizeValue = @capsizeValueList.Random()
	}
	
	//sets capsize indicator, if true use element 0 in the string
	DATA
	{
		type = int
		
		capsizeLogic = @capsizeValue == 180 ? 1 : 0
	}
	
	DATA
	{
		type = List<string>
		
		capsizeStringList = [ "have capsized" , "are adrift" ]
	
	}
	
	//Sets the capsizeString for use in the Contract Description
	DATA
	{
		type = string
		
		capsizeString = @capsizeStringList.ElementAt(@capsizeLogic)
		
	}
	
	//Random Distress Location Pulled from Waypoint Generator Behaviour
	DATA
	{
		type = double
		
		distressLat = @/DistressLocation.Waypoints().ElementAt(5).Latitude()
		distressLong = @/DistressLocation.Waypoints().ElementAt(5).Longitude()

	}
	
	
//CONTRACT DESCRIPTION

	name = CoastGuard-RescueFishermen
	title = S.O.S. Distress Call - @/shipName
	group = KSC Coast Guard
	agent = KSC Coast Guard

	description = An S.O.S. was reported by the fishing vessel @/shipName somewhere in the waters east of KSC.\n\nThe captain reports @/distressReport, and they @/capsizeString. Rescue the crew and return them to an authorized KSC landing zone for a safe recovery. Lt. Dan Kerman from the KSC Coast Guard will be on board to help with the rescue. You may use an airplane, helicopter, or VTOL aircraft.

	synopsis = KSC Coast Guard: Our motto is Always Ready - Kemper Keratus!

	notes = Rescue all fishing vessel crew members from the waters of the ocean and bring them back to KSC for recovery and snacks.
	
	completedMessage = Mission Completed! The crew of the @/shipName thank you for rescuing them from the waters off KSC. Your heroics have not gone unnoticed and your reputation has now grown a little bit more!

//Contract Limits
	maxCompletions = 0
	maxSimultaneous = 1
	weight = 10.0

	autoAccept = false
	declinable = true
	cancellable = true

	minExpiry = 1.0
	maxExpiry = 1.0
	deadline = 1

//Contract Reward Modifiers
	prestige = Significant
	targetBody = Kerbin
	
//Contract Rewards
  	advanceFunds = 5000.0
	rewardFunds = 5000.0
  	rewardReputation = 15.0
 	rewardScience = 1.0
	
//Contract Penalties
  	failureFunds = 10000.0
	failureReputation = 20.0
	

//BEHAVIOURS TO DO WHEN CREATING CONTRACT
	BEHAVIOUR
	{
		name = SpawnPassengers
		type = SpawnPassengers
		
		kerbal = @/kerbalsCoastGuard.ElementAt(0)
		kerbalType = Crew
		
	}

	BEHAVIOUR
	{
		name = SpawnKerbal
		type = SpawnKerbal

		KERBAL
		{
			kerbal = @/kerbalsInDistress.ElementAt(0)
			kerbalType = Unowned
			owned = false
			addToRoster = false
			
			lat = @/distressLat - 0.00004
			lon = @/distressLong - 0.00003
			alt = 0
			heading = 350
			
		}

		KERBAL
		{
			kerbal = @/kerbalsInDistress.ElementAt(1)
			kerbalType = Unowned
			owned = false
			addToRoster = false
			
			lat = @/distressLat + 0.00004
			lon = @/distressLong + 0.00003
			alt = 0
			heading = 270
			
		}
		
	}
	
	BEHAVIOUR
	{
		name = SpawnVessel
		type = SpawnVessel
		deferVesselCreation = false

		VESSEL
		{
			name = @/shipName
			craftURL = ContractPacks/GAP/Assets/Speedboat.craft
			vesselType = Ship
			owned = True
			targetBody = Kerbin
			
			lat = @/distressLat
			lon = @/distressLong
			alt = -5
			heading = 133.5
			pitch = 90
			roll = @/capsizeValue
			
		}
		
	}
	
	BEHAVIOUR
	{
		name = DistressLocation
		type = WaypointGenerator
		
		//Rescue Areas
		
		PQS_CITY
		{
			name = KSC Sea North
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = -1847.25488069029, -20058.7598335702, -453.396403818988
			
			hidden = true
			
		}		

		PQS_CITY
		{
			name = KSC Sea Central
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 20550.8508273184, 1062.93579726917, -468.244493385362
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = KSC Sea South
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 29140.5802921804, 15569.5873430977, -1025.49583004066
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = East Islands Sea
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = -13479.0987451144, 22129.2856859656, -674.933362233103
			
			hidden = true
			
		}
		
		PQS_CITY
		{
			name = South Islands Sea
			
			targetBody = Kerbin
			pqsCity = IslandAirfield 
			pqsOffset = 4175.6529485127, 49157.8040008561, -2146.85443912575
			
			hidden = true
			
		}
		
		//Randomize a 5000m Radius Waypoint Near Rescue Area
		
	    RANDOM_WAYPOINT_NEAR
		{
		
			name = S.O.S
			icon = marker
			
			targetBody = Kerbin
			nearIndex = Random(0,5)
			maxDistance = 7500.0
			altitude = 0.0
		
		}
		
	}
	
//Remove all SpawnVessels when done
	BEHAVIOUR
	{
		name = DestroyVessel
		type = DestroyVessel
		
		onState = CONTRACT_SUCCESS
		vessel = @/shipName
		
	}

	
//PARAMETERS FOR CONTRACT COMPLETION

//Craft definition
	PARAMETER
	{
		name = VesselParameterGroup
		type = VesselParameterGroup
		title = Your craft must
		
		define = craft
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			title = have a Kerbal in command
			
			minCrew = 1
		
			disableOnStateChange = false
			hideChildren = true

		}
		
		PARAMETER
		{
			name = HasCrewCapacity
			type = HasCrewCapacity
			title = have at least 2 passenger seats
			
			minCapacity = 3
			
			disableOnStateChange = false
			
		}
		
		disableOnStateChange = false

	}

//Passenger Manifest - Load Passengers
	PARAMETER
	{
		name = All
		type = All
		
		title = load your Coast Guard rescue officer
		
		PARAMETER
		{
			name = HasPassengers
			type = HasPassengers
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsCoastGuard
				
			}
			
			hideChildren = true
			
		}

	}


//Contract Goals
	PARAMETER
	{
		name = VisitWaypoint
		type = VisitWaypoint
		title = navigate to S.O.S Waypoint
		
		index = 1
		distance = 500
		hideOnCompletion = true
		
		disableOnStateChange = true
		hideChildren = true
		
	}

	PARAMETER
	{
		name = HasCrew
		type = HasCrew
		title =  rescue the crew of the @/shipName
		
		kerbal = @/kerbalsInDistress

		completeInSequence = true
		disableOnStateChange = false
	
	}

//Recovery Parameter - Landing
	PARAMETER
	{
		name = Any
		type = Any
		title = and then land back at KSC
		
		PARAMETER
		{
			name = Any
			type = Any
			title = on either

			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the KSC runway
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = Runway
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the Spaceplane Hangar air terminal
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = SPH
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = the Vehicle Assembly Building helipad
				
				vessel = craft

			PARAMETER
				{
					name = ReachState
					type = ReachState
					
					targetBody = Kerbin
					biome = VAB Main Building
					situation = LANDED
					maxSpeed = 0.0

					disableOnStateChange = false
					hideChildren = true

				}

				hideChildren = true		

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = or the Administration Building helipad
				
				vessel = craft

				PARAMETER
				{
					name = ReachState
					type = ReachState

					targetBody = Kerbin
					biome = Administration	
					situation = LANDED
					maxSpeed = 0.0
					
					disableOnStateChange = false
					hideChildren = true
					
				}

				hideChildren = true	

			}
			
			PARAMETER
			{
				name = VesselParameterGroup
				type = VesselParameterGroup
				title = or the KSC Island Airfield
				
				vessel = craft
				
				REQUIREMENT
				{
					name = CompleteContract
					type = CompleteContract

					contractType = KSP-IslandPrep
					minCount = 1
					
				}

				PARAMETER
				{
					name = ReachState
					type = ReachState

					targetBody = Kerbin
					biome = IslandAirfield	
					situation = LANDED
					maxSpeed = 0.0
					
					disableOnStateChange = false
					hideChildren = true
					
				}

				hideChildren = true

			}
		
		}

	}

//Recovery Parameter - Craft & Kerbal Safety Check
	PARAMETER
	{
		name = All
		type = All
		title = safely
		
		completeInSequence = true
		disableOnStateChange = true
		
		PARAMETER
		{
			name = VesselNotDestroyed
			type = VesselNotDestroyed
			title = without destroying your craft
			
			vessel = craft

		}
		
		PARAMETER
		{
			name = KerbalDeaths
			type = KerbalDeaths
			title = or killing anyone
			
			countMax = 1

		}
		
	}
	
//Recovery Parameter - Recover Kerbals
	PARAMETER
	{
		name = All
		type = All
		title = and recover
		
		PARAMETER
		{
			name = RecoverKerbal
			type = RecoverKerbal
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsCoastGuard
				
			}
			
			hideChildren = true
			
		}
		
		PARAMETER
		{
			name = RecoverKerbal
			type = RecoverKerbal
			title = @kerbal.First()
	
			ITERATOR
			{
				type = Kerbal
				kerbal = @/kerbalsInDistress
				
			}
			
			hideChildren = true
			
		}
		
	}
	
}